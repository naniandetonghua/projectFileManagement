# 项目交付物管理系统概要设计说明书

## 1. 系统概述

### 1.1 系统名称
项目交付物管理系统

### 1.2 系统目标
开发一款项目交付物管理系统，对开发过程的交付物进行统一管理，提高项目管理的规范性和效率。

### 1.3 系统范围
- 支持项目交付物的上传、查看、管理
- 支持项目分类（重大/普通）管理
- 支持交付物状态跟踪（已上传/未上传）
- 支持系统-项目的层级结构管理

## 2. 系统架构设计

### 2.1 总体架构
采用前后端分离的B/S架构：
- 前端：Vue.js + Element UI
- 后端：Java Spring Boot
- 数据库：MySQL
- 文件存储：应用服务器本地磁盘目录

### 2.2 技术架构图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端 (Vue)    │    │   后端 (Spring) │    │   数据库 (MySQL) │
│                 │    │                 │    │                 │
│ - 项目树展示    │◄──►│ - REST API      │◄──►│ - 系统表        │
│ - 交付物管理    │    │ - 文件上传      │    │ - 项目表        │
│ - 状态显示      │    │ - 业务逻辑      │    │ - 交付物表      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │
                                ▼
                       ┌─────────────────┐
                       │   文件存储      │
                       │   (本地磁盘)    │
                       │                 │
                       │ - 交付物文件    │
                       │ - 文件管理      │
                       └─────────────────┘
```

### 2.3 系统部署架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Nginx (80)    │    │  Spring Boot    │    │   MySQL (3306)  │
│                 │    │   (8080)        │    │                 │
│ - 静态资源      │◄──►│ - 应用服务      │◄──►│ - 数据存储      │
│ - 反向代理      │    │ - 文件处理      │    │ - 事务管理      │
│ - 负载均衡      │    │ - 业务逻辑      │    │ - 备份恢复      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │
                                ▼
                       ┌─────────────────┐
                       │   文件系统      │
                       │                 │
                       │ /uploads/       │
                       │ /logs/          │
                       │ /backup/        │
                       └─────────────────┘
```

## 3. 功能模块设计

### 3.1 系统管理模块
- 系统信息管理
- 用户权限管理
- 系统配置管理

### 3.2 项目管理模块
- 项目创建、编辑、删除
- 项目分类管理（重大/普通）
- 项目状态管理

### 3.3 交付物管理模块
- 交付物上传、下载、删除
- 交付物状态跟踪
- 交付物清单管理

### 3.4 文件管理模块
- 文件上传、下载
- 文件存储管理
- 文件权限控制

## 4. 数据库设计

### 4.1 系统表 (sys_system)
```sql
CREATE TABLE sys_system (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    system_name VARCHAR(100) NOT NULL COMMENT '系统名称',
    system_code VARCHAR(50) NOT NULL COMMENT '系统编码',
    description TEXT COMMENT '系统描述',
    status TINYINT DEFAULT 1 COMMENT '状态：1-启用，0-禁用',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 4.2 项目表 (sys_project)
```sql
CREATE TABLE sys_project (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    system_id BIGINT NOT NULL COMMENT '所属系统ID',
    project_name VARCHAR(200) NOT NULL COMMENT '项目名称',
    project_code VARCHAR(100) NOT NULL COMMENT '项目编码',
    project_type TINYINT NOT NULL COMMENT '项目类型：1-重大，2-普通',
    description TEXT COMMENT '项目描述',
    status TINYINT DEFAULT 1 COMMENT '状态：1-进行中，2-已完成，3-暂停，4-中止',
    start_date DATE COMMENT '开始日期',
    end_date DATE COMMENT '结束日期',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (system_id) REFERENCES sys_system(id)
);
```

### 4.3 交付物类型表 (sys_deliverable_type)
```sql
CREATE TABLE sys_deliverable_type (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    type_name VARCHAR(100) NOT NULL COMMENT '交付物类型名称',
    type_code VARCHAR(50) NOT NULL COMMENT '交付物类型编码',
    sort_order INT DEFAULT 0 COMMENT '排序',
    is_required TINYINT DEFAULT 1 COMMENT '是否必填：1-必填，0-非必填',
    applicable_project_type TINYINT COMMENT '适用项目类型：1-重大，2-普通，3-全部',
    description TEXT COMMENT '描述',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 4.4 交付物表 (sys_deliverable)
```sql
CREATE TABLE sys_deliverable (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id BIGINT NOT NULL COMMENT '项目ID',
    deliverable_type_id BIGINT NOT NULL COMMENT '交付物类型ID',
    file_name VARCHAR(200) COMMENT '文件名',
    file_path VARCHAR(500) COMMENT '文件路径',
    file_size BIGINT COMMENT '文件大小(字节)',
    upload_time DATETIME COMMENT '上传时间',
    upload_user VARCHAR(50) COMMENT '上传用户',
    status TINYINT DEFAULT 0 COMMENT '状态：0-未上传，1-已上传',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (project_id) REFERENCES sys_project(id),
    FOREIGN KEY (deliverable_type_id) REFERENCES sys_deliverable_type(id)
);
```

## 5. 接口设计

### 5.1 系统管理接口
```
GET    /api/system/list          # 获取系统列表
POST   /api/system/create        # 创建系统
PUT    /api/system/update        # 更新系统
DELETE /api/system/delete/{id}   # 删除系统
```

### 5.2 项目管理接口
```
GET    /api/project/list         # 获取项目列表
GET    /api/project/{id}         # 获取项目详情
POST   /api/project/create       # 创建项目
PUT    /api/project/update       # 更新项目
DELETE /api/project/delete/{id}  # 删除项目
```

### 5.3 交付物管理接口
```
GET    /api/deliverable/list/{projectId}     # 获取项目交付物列表
POST   /api/deliverable/upload               # 上传交付物
GET    /api/deliverable/download/{id}        # 下载交付物
DELETE /api/deliverable/delete/{id}          # 删除交付物
```

## 6. 前端页面设计

### 6.1 主页面布局
- 左侧：系统-项目树形结构
- 右侧：项目交付物管理区域
- 顶部：项目类型选择（重大/普通）

### 6.2 页面组件
- 系统树组件 (SystemTree.vue)
- 项目列表组件 (ProjectList.vue)
- 交付物管理组件 (DeliverableManager.vue)
- 文件上传组件 (FileUpload.vue)

### 6.3 状态显示
- 已上传交付物：绿色背景
- 未上传交付物：黄色背景
- 非必填交付物：灰色文字

## 7. 文件存储设计

### 7.1 存储结构
```
/uploads/
├── system_{systemId}/
│   └── project_{projectId}/
│       ├── deliverable_{typeId}_1.pdf
│       ├── deliverable_{typeId}_2.docx
│       └── ...
```

### 7.2 文件命名规则
- 格式：deliverable_{交付物类型ID}_{时间戳}.{文件扩展名}
- 示例：deliverable_1_20240101120000.pdf

## 8. 安全设计

### 8.1 文件安全
- 文件上传类型限制
- 文件大小限制
- 文件路径安全验证

### 8.2 权限控制
- 基于角色的访问控制
- 项目级别的权限管理
- 文件访问权限控制

## 9. 部署方案

### 9.1 环境要求
- JDK 8+
- MySQL 5.7+
- Node.js 14+
- Nginx (可选)

### 9.2 部署结构
```
/opt/project-delivery/
├── backend/          # Spring Boot应用
├── frontend/         # Vue应用
├── uploads/          # 文件存储目录
└── logs/             # 日志目录
```

## 10. 交付物清单

### 10.1 必填交付物（所有项目）
1. 业务需求文档
2. 项目立项申请表
3. 技术可行性分析报告
4. 立项综合评审报告
5. 技术需求分析文档
6. 技术研发需求要点清单
7. 技术需求评审报告
8. 概要设计说明书
9. 详细设计说明书
10. 数据库设计说明书
11. 系统设计评审报告
12. 代码评审报告
13. 技术测试方案
14. 技术测试方案评审报告
15. 业务测试方案
16. 业务测试方案评审报告
17. 需求变更申请及确认表
18. 项目验收报告
22. 项目后评价报告
23. 系统后评价报告

### 10.2 重大项目额外交付物
24. 重大项目立项报告
25. 重大项目季度进展报告
26. 重大项目后评价报告

### 10.3 非必填交付物
19. 项目暂停/中止报告
20. 项目重新启动申请
21. 生产系统终止运行申请

## 11. 开发计划

### 11.1 第一阶段（2周）
- 数据库设计和创建
- 后端基础框架搭建
- 基础CRUD接口开发

### 11.2 第二阶段（2周）
- 文件上传下载功能
- 前端基础页面开发
- 系统树形结构实现

### 11.3 第三阶段（1周）
- 交付物状态管理
- 项目类型筛选
- 界面优化和测试

### 11.4 第四阶段（1周）
- 系统集成测试
- 部署和上线
- 用户培训

## 12. 风险评估

### 12.1 技术风险
- 文件存储安全性
- 大文件上传性能
- 数据库性能优化

### 12.2 业务风险
- 用户需求变更
- 交付物类型调整
- 权限管理复杂性

## 13. 详细技术实现

### 13.1 后端技术栈详细说明

#### 13.1.1 Spring Boot配置
```yaml
# application.yml 核心配置
spring:
  datasource:
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true
        use_sql_comments: true
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true
  
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 100MB
      file-size-threshold: 2KB
      location: /tmp
```

#### 13.1.2 文件上传服务实现
```java
@Service
@Slf4j
public class FileService {
    
    @Value("${file.upload.path}")
    private String uploadPath;
    
    @Value("${file.upload.allowed-types}")
    private String allowedTypes;
    
    @Value("${file.upload.max-size}")
    private long maxSize;
    
    public FileUploadResult uploadFile(MultipartFile file, Long projectId, Long deliverableTypeId) {
        // 文件验证
        validateFile(file);
        
        // 生成文件路径
        String fileName = generateFileName(file, deliverableTypeId);
        String relativePath = buildRelativePath(projectId, fileName);
        String absolutePath = uploadPath + relativePath;
        
        // 创建目录
        createDirectoryIfNotExists(absolutePath);
        
        // 保存文件
        try {
            file.transferTo(new File(absolutePath));
            
            // 保存到数据库
            Deliverable deliverable = new Deliverable();
            deliverable.setProjectId(projectId);
            deliverable.setDeliverableTypeId(deliverableTypeId);
            deliverable.setFileName(file.getOriginalFilename());
            deliverable.setFilePath(relativePath);
            deliverable.setFileSize(file.getSize());
            deliverable.setUploadTime(LocalDateTime.now());
            deliverable.setUploadUser(getCurrentUser());
            deliverable.setStatus(1);
            
            deliverableRepository.save(deliverable);
            
            return FileUploadResult.success(deliverable);
        } catch (IOException e) {
            log.error("文件上传失败", e);
            throw new BusinessException("文件上传失败");
        }
    }
    
    private void validateFile(MultipartFile file) {
        // 文件大小验证
        if (file.getSize() > maxSize) {
            throw new BusinessException("文件大小超过限制");
        }
        
        // 文件类型验证
        String extension = getFileExtension(file.getOriginalFilename());
        if (!allowedTypes.contains(extension.toLowerCase())) {
            throw new BusinessException("不支持的文件类型");
        }
        
        // 文件名安全验证
        if (!isValidFileName(file.getOriginalFilename())) {
            throw new BusinessException("文件名包含非法字符");
        }
    }
}
```

#### 13.1.3 交付物状态管理
```java
@Service
public class DeliverableService {
    
    public List<DeliverableStatusDTO> getProjectDeliverableStatus(Long projectId, Integer projectType) {
        // 获取项目信息
        Project project = projectRepository.findById(projectId)
            .orElseThrow(() -> new BusinessException("项目不存在"));
        
        // 获取适用的交付物类型
        List<DeliverableType> types = deliverableTypeRepository.findByApplicableProjectType(
            projectType == 1 ? 1 : (projectType == 2 ? 2 : 3)
        );
        
        // 获取已上传的交付物
        List<Deliverable> uploadedDeliverables = deliverableRepository.findByProjectId(projectId);
        Map<Long, Deliverable> uploadedMap = uploadedDeliverables.stream()
            .collect(Collectors.toMap(Deliverable::getDeliverableTypeId, d -> d));
        
        // 构建状态列表
        return types.stream()
            .map(type -> {
                DeliverableStatusDTO dto = new DeliverableStatusDTO();
                dto.setDeliverableTypeId(type.getId());
                dto.setTypeName(type.getTypeName());
                dto.setTypeCode(type.getTypeCode());
                dto.setRequired(type.getIsRequired() == 1);
                dto.setSortOrder(type.getSortOrder());
                
                Deliverable uploaded = uploadedMap.get(type.getId());
                if (uploaded != null) {
                    dto.setUploaded(true);
                    dto.setFileName(uploaded.getFileName());
                    dto.setUploadTime(uploaded.getUploadTime());
                    dto.setUploadUser(uploaded.getUploadUser());
                } else {
                    dto.setUploaded(false);
                }
                
                return dto;
            })
            .sorted(Comparator.comparing(DeliverableStatusDTO::getSortOrder))
            .collect(Collectors.toList());
    }
}
```

### 13.2 前端技术实现详细说明

#### 13.2.1 Vue 3 Composition API实现
```vue
<template>
  <div class="deliverable-manager">
    <div class="project-info">
      <h2>{{ project?.projectName }}</h2>
      <el-tag :type="project?.projectType === 1 ? 'danger' : 'primary'">
        {{ project?.projectType === 1 ? '重大项目' : '普通项目' }}
      </el-tag>
    </div>
    
    <div class="deliverable-list">
      <div
        v-for="item in deliverableList"
        :key="item.deliverableTypeId"
        class="deliverable-item"
        :class="getItemClass(item)"
      >
        <div class="item-header">
          <div class="item-title">
            <span class="title-text">{{ item.typeName }}</span>
            <el-tag v-if="!item.required" size="small" type="info">非必填</el-tag>
          </div>
          <div class="item-status">
            <el-tag :type="getStatusType(item)" size="small">
              {{ getStatusText(item) }}
            </el-tag>
          </div>
        </div>
        
        <div class="item-content">
          <div v-if="item.uploaded" class="file-info">
            <i class="el-icon-document"></i>
            <span class="file-name">{{ item.fileName }}</span>
            <span class="upload-info">
              上传时间：{{ formatDateTime(item.uploadTime) }}
            </span>
          </div>
          
          <div class="item-actions">
            <el-button
              v-if="!item.uploaded"
              type="primary"
              size="small"
              @click="handleUpload(item)"
            >
              上传文件
            </el-button>
            <el-button
              v-else
              type="success"
              size="small"
              @click="handleDownload(item)"
            >
              下载
            </el-button>
            <el-button
              v-if="item.uploaded"
              type="danger"
              size="small"
              @click="handleDelete(item)"
            >
              删除
            </el-button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 文件上传对话框 -->
    <FileUploadDialog
      v-model="uploadDialogVisible"
      :deliverable-type="currentDeliverableType"
      :project-id="projectId"
      @success="handleUploadSuccess"
    />
  </div>
</template>

<script setup>
import { ref, computed, onMounted, watch } from 'vue'
import { useStore } from 'vuex'
import { ElMessage, ElMessageBox } from 'element-plus'
import { getDeliverableList, downloadDeliverable, deleteDeliverable } from '@/api/deliverable'
import FileUploadDialog from '@/components/FileUploadDialog.vue'
import { formatDateTime } from '@/utils/date'

// Props
const props = defineProps({
  projectId: {
    type: [String, Number],
    required: true
  },
  projectType: {
    type: Number,
    default: 2
  }
})

// 响应式数据
const store = useStore()
const deliverableList = ref([])
const uploadDialogVisible = ref(false)
const currentDeliverableType = ref(null)
const loading = ref(false)

// 计算属性
const project = computed(() => store.state.project.currentProject)

// 方法
const loadDeliverableList = async () => {
  try {
    loading.value = true
    const response = await getDeliverableList(props.projectId, props.projectType)
    deliverableList.value = response.data
  } catch (error) {
    ElMessage.error('获取交付物列表失败')
  } finally {
    loading.value = false
  }
}

const getItemClass = (item) => {
  const classes = ['deliverable-item']
  if (item.uploaded) {
    classes.push('uploaded')
  } else {
    classes.push('not-uploaded')
  }
  if (!item.required) {
    classes.push('not-required')
  }
  return classes
}

const getStatusType = (item) => {
  if (!item.required) return 'info'
  return item.uploaded ? 'success' : 'warning'
}

const getStatusText = (item) => {
  if (!item.required) return '非必填'
  return item.uploaded ? '已上传' : '未上传'
}

const handleUpload = (item) => {
  currentDeliverableType.value = item
  uploadDialogVisible.value = true
}

const handleDownload = async (item) => {
  try {
    const response = await downloadDeliverable(item.deliverableId)
    const blob = new Blob([response.data])
    const url = window.URL.createObjectURL(blob)
    const link = document.createElement('a')
    link.href = url
    link.download = item.fileName
    link.click()
    window.URL.revokeObjectURL(url)
  } catch (error) {
    ElMessage.error('文件下载失败')
  }
}

const handleDelete = async (item) => {
  try {
    await ElMessageBox.confirm('确定要删除这个交付物吗？', '确认删除', {
      type: 'warning'
    })
    
    await deleteDeliverable(item.deliverableId)
    ElMessage.success('删除成功')
    await loadDeliverableList()
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('删除失败')
    }
  }
}

const handleUploadSuccess = async () => {
  ElMessage.success('上传成功')
  await loadDeliverableList()
}

// 生命周期
onMounted(() => {
  loadDeliverableList()
})

watch(() => props.projectType, () => {
  loadDeliverableList()
})
</script>

<style lang="scss" scoped>
.deliverable-manager {
  .project-info {
    margin-bottom: 20px;
    padding: 16px;
    background: #f5f7fa;
    border-radius: 8px;
    
    h2 {
      margin: 0 0 8px 0;
      color: #303133;
    }
  }
  
  .deliverable-list {
    .deliverable-item {
      border: 1px solid #e6e6e6;
      border-radius: 8px;
      margin-bottom: 16px;
      padding: 16px;
      transition: all 0.3s ease;
      
      &.uploaded {
        border-color: #67c23a;
        background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
        
        &:hover {
          box-shadow: 0 4px 12px rgba(103, 194, 58, 0.15);
        }
      }
      
      &.not-uploaded {
        border-color: #e6a23c;
        background: linear-gradient(135deg, #fdf6ec 0%, #fef9f0 100%);
        
        &:hover {
          box-shadow: 0 4px 12px rgba(230, 162, 60, 0.15);
        }
      }
      
      &.not-required {
        opacity: 0.7;
        background: #fafafa;
      }
      
      .item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        
        .item-title {
          display: flex;
          align-items: center;
          gap: 8px;
          
          .title-text {
            font-weight: 600;
            color: #303133;
          }
        }
      }
      
      .item-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        
        .file-info {
          display: flex;
          align-items: center;
          gap: 8px;
          color: #606266;
          
          .file-name {
            font-weight: 500;
          }
          
          .upload-info {
            font-size: 12px;
            color: #909399;
          }
        }
        
        .item-actions {
          display: flex;
          gap: 8px;
        }
      }
    }
  }
}
</style>
```

#### 13.2.2 系统树组件实现
```vue
<template>
  <div class="system-tree-container">
    <div class="tree-header">
      <h3>系统项目树</h3>
      <el-button type="primary" size="small" @click="handleAddSystem">
        添加系统
      </el-button>
    </div>
    
    <div class="tree-content">
      <el-tree
        ref="treeRef"
        :data="treeData"
        :props="treeProps"
        node-key="id"
        :expand-on-click-node="false"
        :default-expanded-keys="expandedKeys"
        @node-click="handleNodeClick"
      >
        <template #default="{ node, data }">
          <span class="custom-tree-node">
            <i :class="getNodeIcon(data)" class="node-icon"></i>
            <span class="node-label">{{ node.label }}</span>
            <span v-if="data.type === 'project'" class="project-type-tag">
              <el-tag :type="data.projectType === 1 ? 'danger' : 'primary'" size="mini">
                {{ data.projectType === 1 ? '重大' : '普通' }}
              </el-tag>
            </span>
          </span>
        </template>
      </el-tree>
    </div>
    
    <!-- 添加系统对话框 -->
    <SystemFormDialog
      v-model="systemDialogVisible"
      @success="handleSystemSuccess"
    />
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import { useStore } from 'vuex'
import { ElMessage } from 'element-plus'
import SystemFormDialog from '@/components/SystemFormDialog.vue'

// 响应式数据
const store = useStore()
const treeRef = ref(null)
const systemDialogVisible = ref(false)
const expandedKeys = ref([])

// 计算属性
const treeData = computed(() => {
  return store.state.system.systemList.map(system => ({
    id: `system_${system.id}`,
    label: system.systemName,
    type: 'system',
    system: system,
    children: system.projects?.map(project => ({
      id: `project_${project.id}`,
      label: project.projectName,
      type: 'project',
      project: project,
      projectType: project.projectType
    })) || []
  }))
})

const treeProps = {
  children: 'children',
  label: 'label'
}

// 方法
const getNodeIcon = (data) => {
  if (data.type === 'system') {
    return 'el-icon-folder'
  } else {
    return 'el-icon-document'
  }
}

const handleNodeClick = (data) => {
  if (data.type === 'system') {
    // 展开/收起系统节点
    const node = treeRef.value.getNode(data.id)
    if (node.expanded) {
      treeRef.value.collapse(data.id)
    } else {
      treeRef.value.expand(data.id)
    }
  } else if (data.type === 'project') {
    // 选择项目
    store.commit('project/SET_CURRENT_PROJECT', data.project)
    emit('select-project', data.project)
  }
}

const handleAddSystem = () => {
  systemDialogVisible.value = true
}

const handleSystemSuccess = async () => {
  ElMessage.success('系统添加成功')
  await store.dispatch('system/fetchSystemList')
}

// 生命周期
onMounted(async () => {
  await store.dispatch('system/fetchSystemList')
  // 默认展开第一个系统
  if (treeData.value.length > 0) {
    expandedKeys.value = [treeData.value[0].id]
  }
})
</script>
```

## 14. 测试方案

### 14.1 单元测试
```java
@SpringBootTest
@Transactional
class DeliverableServiceTest {
    
    @Autowired
    private DeliverableService deliverableService;
    
    @Autowired
    private ProjectRepository projectRepository;
    
    @Test
    void testGetProjectDeliverableStatus() {
        // 准备测试数据
        Project project = createTestProject();
        projectRepository.save(project);
        
        // 执行测试
        List<DeliverableStatusDTO> result = deliverableService
            .getProjectDeliverableStatus(project.getId(), 2);
        
        // 验证结果
        assertNotNull(result);
        assertFalse(result.isEmpty());
        assertEquals(23, result.size()); // 普通项目应该有23个交付物类型
    }
    
    @Test
    void testUploadDeliverable() {
        // 准备测试文件
        MockMultipartFile file = new MockMultipartFile(
            "file", 
            "test.pdf", 
            "application/pdf", 
            "test content".getBytes()
        );
        
        // 执行测试
        FileUploadResult result = deliverableService.uploadFile(
            file, 1L, 1L
        );
        
        // 验证结果
        assertTrue(result.isSuccess());
        assertNotNull(result.getDeliverable());
    }
}
```

### 14.2 集成测试
```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
class DeliverableControllerIntegrationTest {
    
    @Autowired
    private TestRestTemplate restTemplate;
    
    @Test
    void testGetDeliverableList() {
        // 执行测试
        ResponseEntity<ApiResponse> response = restTemplate.getForEntity(
            "/api/deliverable/list/1", 
            ApiResponse.class
        );
        
        // 验证结果
        assertEquals(HttpStatus.OK, response.getStatusCode());
        assertNotNull(response.getBody());
        assertEquals(200, response.getBody().getCode());
    }
    
    @Test
    void testUploadDeliverable() {
        // 准备测试文件
        MultiValueMap<String, Object> body = new LinkedMultiValueMap<>();
        body.add("file", new ByteArrayResource("test content".getBytes()) {
            @Override
            public String getFilename() {
                return "test.pdf";
            }
        });
        body.add("projectId", "1");
        body.add("deliverableTypeId", "1");
        
        // 执行测试
        ResponseEntity<ApiResponse> response = restTemplate.postForEntity(
            "/api/deliverable/upload",
            body,
            ApiResponse.class
        );
        
        // 验证结果
        assertEquals(HttpStatus.OK, response.getStatusCode());
        assertNotNull(response.getBody());
        assertEquals(200, response.getBody().getCode());
    }
}
```

### 14.3 前端测试
```javascript
// 组件测试
import { mount } from '@vue/test-utils'
import DeliverableManager from '@/components/DeliverableManager.vue'

describe('DeliverableManager', () => {
  it('should render deliverable list correctly', () => {
    const wrapper = mount(DeliverableManager, {
      props: {
        projectId: 1,
        projectType: 2
      }
    })
    
    expect(wrapper.find('.deliverable-list').exists()).toBe(true)
  })
  
  it('should show upload button for not uploaded items', () => {
    const wrapper = mount(DeliverableManager, {
      props: {
        projectId: 1,
        projectType: 2
      }
    })
    
    const uploadButtons = wrapper.findAll('.el-button--primary')
    expect(uploadButtons.length).toBeGreaterThan(0)
  })
})
```

## 15. 性能优化方案

### 15.1 数据库优化
```sql
-- 创建复合索引
CREATE INDEX idx_deliverable_project_type ON sys_deliverable(project_id, deliverable_type_id);
CREATE INDEX idx_project_system_type ON sys_project(system_id, project_type);

-- 查询优化
EXPLAIN SELECT 
    p.id as project_id,
    p.project_name,
    dt.id as deliverable_type_id,
    dt.type_name,
    CASE WHEN d.id IS NOT NULL THEN 1 ELSE 0 END as is_uploaded
FROM sys_project p
CROSS JOIN sys_deliverable_type dt
LEFT JOIN sys_deliverable d ON p.id = d.project_id AND dt.id = d.deliverable_type_id
WHERE p.id = ? AND (dt.applicable_project_type = 3 OR dt.applicable_project_type = ?)
ORDER BY dt.sort_order;
```

### 15.2 缓存策略
```java
@Service
@CacheConfig(cacheNames = "deliverable")
public class DeliverableService {
    
    @Cacheable(key = "#projectId + '_' + #projectType")
    public List<DeliverableStatusDTO> getProjectDeliverableStatus(Long projectId, Integer projectType) {
        // 实现逻辑
    }
    
    @CacheEvict(key = "#projectId + '_*'")
    public void uploadDeliverable(Long projectId, Long deliverableTypeId, MultipartFile file) {
        // 实现逻辑
    }
}
```

### 15.3 前端性能优化
```javascript
// 虚拟滚动优化大数据列表
import { VirtualList } from 'vue-virtual-scroll-list'

export default {
  components: {
    VirtualList
  },
  data() {
    return {
      itemSize: 80, // 每个项目的高度
      visibleCount: 10 // 可见项目数量
    }
  }
}
```

## 16. 监控和运维

### 16.1 应用监控
```yaml
# application-monitor.yml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
```

### 16.2 日志配置
```xml
<!-- logback-spring.xml -->
<configuration>
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>/opt/project-delivery/logs/application.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <fileNamePattern>/opt/project-delivery/logs/application.%d{yyyy-MM-dd}.%i.log</fileNamePattern>
            <timeBasedFileNamingAndTriggeringPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP">
                <maxFileSize>100MB</maxFileSize>
            </timeBasedFileNamingAndTriggeringPolicy>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <root level="INFO">
        <appender-ref ref="FILE"/>
    </root>
</configuration>
```

### 16.3 健康检查
```java
@Component
public class FileSystemHealthIndicator implements HealthIndicator {
    
    @Value("${file.upload.path}")
    private String uploadPath;
    
    @Override
    public Health health() {
        try {
            File uploadDir = new File(uploadPath);
            if (!uploadDir.exists()) {
                uploadDir.mkdirs();
            }
            
            if (uploadDir.canWrite()) {
                return Health.up()
                    .withDetail("uploadPath", uploadPath)
                    .withDetail("freeSpace", uploadDir.getFreeSpace())
                    .build();
            } else {
                return Health.down()
                    .withDetail("uploadPath", uploadPath)
                    .withDetail("error", "Directory not writable")
                    .build();
            }
        } catch (Exception e) {
            return Health.down()
                .withDetail("uploadPath", uploadPath)
                .withDetail("error", e.getMessage())
                .build();
        }
    }
}
```

## 17. 部署脚本

### 17.1 Docker部署
```dockerfile
# Dockerfile
FROM openjdk:8-jre-alpine

# 安装必要的工具
RUN apk add --no-cache curl

# 创建应用目录
WORKDIR /app

# 复制应用jar包
COPY target/project-delivery-backend-1.0.0.jar app.jar

# 创建文件存储目录
RUN mkdir -p /app/uploads /app/logs

# 暴露端口
EXPOSE 8080

# 健康检查
HEALTHCHECK --interval=30s --timeout=3s --start-period=60s --retries=3 \
  CMD curl -f http://localhost:8080/actuator/health || exit 1

# 启动应用
ENTRYPOINT ["java", "-jar", "app.jar"]
```

### 17.2 Docker Compose
```yaml
# docker-compose.yml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: project-delivery-mysql
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: project_delivery_system
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./database-init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - project-delivery-network

  backend:
    build: ./backend
    container_name: project-delivery-backend
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/project_delivery_system
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: password
    volumes:
      - uploads_data:/app/uploads
      - logs_data:/app/logs
    depends_on:
      - mysql
    networks:
      - project-delivery-network

  frontend:
    build: ./frontend
    container_name: project-delivery-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - project-delivery-network

  nginx:
    image: nginx:alpine
    container_name: project-delivery-nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - frontend_build:/usr/share/nginx/html
    depends_on:
      - frontend
    networks:
      - project-delivery-network

volumes:
  mysql_data:
  uploads_data:
  logs_data:
  frontend_build:

networks:
  project-delivery-network:
    driver: bridge
```

### 17.3 部署脚本
```bash
#!/bin/bash
# deploy.sh

set -e

echo "开始部署项目交付物管理系统..."

# 检查Docker是否安装
if ! command -v docker &> /dev/null; then
    echo "错误: Docker未安装"
    exit 1
fi

# 检查Docker Compose是否安装
if ! command -v docker-compose &> /dev/null; then
    echo "错误: Docker Compose未安装"
    exit 1
fi

# 创建必要的目录
echo "创建部署目录..."
mkdir -p /opt/project-delivery/{uploads,logs,backup}

# 构建后端
echo "构建后端应用..."
cd backend
mvn clean package -DskipTests
cd ..

# 构建前端
echo "构建前端应用..."
cd frontend
npm install
npm run build
cd ..

# 启动服务
echo "启动服务..."
docker-compose up -d

# 等待服务启动
echo "等待服务启动..."
sleep 30

# 检查服务状态
echo "检查服务状态..."
docker-compose ps

# 检查健康状态
echo "检查应用健康状态..."
curl -f http://localhost:8080/actuator/health || echo "后端健康检查失败"
curl -f http://localhost/ || echo "前端访问失败"

echo "部署完成！"
echo "前端访问地址: http://localhost"
echo "后端API地址: http://localhost:8080"
echo "健康检查地址: http://localhost:8080/actuator/health"
```

## 18. 总结

本概要设计文档为项目交付物管理系统提供了完整的技术方案，包括：

1. **系统架构设计**：采用前后端分离的现代化架构
2. **数据库设计**：完整的表结构设计和初始化脚本
3. **接口设计**：RESTful API接口规范
4. **前端设计**：Vue 3 + Element Plus的现代化UI
5. **安全设计**：文件安全和权限控制
6. **部署方案**：Docker容器化部署
7. **测试方案**：单元测试、集成测试和前端测试
8. **性能优化**：数据库优化、缓存策略和前端优化
9. **监控运维**：应用监控、日志管理和健康检查

系统将采用现代化的技术栈，确保系统的可扩展性、安全性和易用性。通过合理的架构设计和详细的技术实现方案，为项目的成功实施提供了坚实的基础。 